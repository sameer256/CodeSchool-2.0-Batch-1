-- Active: 1692271638519@@127.0.0.1@5432@hr_management@public

CREATE TABLE
    Employees(
        employee_id SERIAL PRIMARY KEY NOT NULL,
        emp_name VARCHAR(50) NOT NULL,
        emp_email VARCHAR(100) UNIQUE,
        emp_phone VARCHAR(15) UNIQUE NOT NULL,
        emp_department VARCHAR(200) NOT NULL,
        emp_jobTitle VARCHAR(250) NOT NULL,
        emp_gender VARCHAR(20) NOT NULL,
        hire_date DATE NOT NULL,
        reportingTo INT,
        login_id VARCHAR(200) UNIQUE,
        password VARCHAR(250),
        type VARCHAR(100)
    );

DROP TABLE employees;

SELECT * from employees;

SELECT *
FROM employees
WHERE
    login_id = 'A1001'
    AND password = 'hr123';

INSERT INTO
    employees(
        emp_name,
        emp_email,
        emp_phone,
        emp_department,
        emp_jobTitle,
        emp_gender,
        hire_date,
        login_id,
        password,
        type
    )
VALUES (
        'Divya',
        'divya123@gmail.com',
        '012314556',
        'HR',
        'HR',
        'Female',
        '20-3-2017',
        'A1001',
        'hr123',
        'hr'
    );

INSERT INTO
    Employees(
        emp_name,
        emp_email,
        emp_phone,
        emp_department,
        emp_jobTitle,
        emp_gender,
        hire_date,
        login_id,
        password
    )
VALUES (
        'Shoban',
        'shoban123@gmail.com',
        '9201377450',
        'Developement',
        'Manager',
        'Male',
        '10-12-2020',
        'A1002',
        'shoban123'
    ), (
        'Ravi',
        'ravi123@gmail.com',
        '9201677450',
        'Testing',
        'Manager',
        'Male',
        '10-11-2020',
        'A1003',
        'ravi123'
    ), (
        'Jaithri',
        'jaithri123@gmail.com',
        '9201377455',
        'Finance',
        'Manager',
        'Female',
        '15-5-2020',
        'A1004',
        'jaithri123'
    );

INSERT INTO
    Employees(
        emp_name,
        emp_email,
        emp_phone,
        emp_department,
        emp_jobTitle,
        emp_gender,
        hire_date,
        reportingTo,
        login_id,
        password
    )
VALUES (
        'Jhones',
        'jhones123@gmail.com',
        '9201377400',
        'Developement',
        'Developer',
        'Male',
        '10-6-2022',
        2,
        'D1001',
        'jhones123'
    ), (
        'Sai',
        'sai123@gmail.com',
        '9202377450',
        'Developement',
        'Developer',
        'Male',
        '10-2-2022',
        2,
        'D1002',
        'sai123'
    ), (
        'goldy',
        'goldy123@gmail.com',
        '8201377450',
        'Testing',
        'Tester',
        'Female',
        '9-3-2022',
        3,
        'T1001',
        'goldy123'
    ), (
        'Sudheer',
        'sudheer123@gmail.com',
        '9231377450',
        'Testing',
        'Tester',
        'Male',
        '10-4-2022',
        3,
        'T1002',
        'sudheer123'
    ), (
        'Rashmi',
        'rashmi123@gmail.com',
        '9201379450',
        'Finance',
        'Accountant',
        'Female',
        '30-5-2022',
        4,
        'F1001',
        'rashmi123'
    ), (
        'Manjula',
        'manjula123@gmail.com',
        '9207307450',
        'Finance',
        'Accountant',
        'Female',
        '10-12-2022',
        4,
        'F1002',
        'manjula123'
    );

DROP Table employees;

CREATE TABLE
    Departments(
        department_id SERIAL NOT NULL PRIMARY KEY,
        department_name VARCHAR(100)
    );

DROP Table departments;

INSERT INTO
    departments(department_name)
VALUES ('Development'), ('Testing'), ('HR'), ('Finance');

SELECT * from departments;

CREATE TABLE
    Attendance(
        attendance_id SERIAL PRIMARY KEY,
        employee_id INT REFERENCES Employees(employee_id) NOT NULL,
        login_time VARCHAR(200),
        logout_time VARCHAR(200),
        date TIMESTAMPTZ DEFAULT Now() NOT NULL
    );

INSERT INTO
    attendance(
        employee_id,
        login_time,
        logout_time,
        date
    )
VALUES (1, '', '', '2021-07-03');

INSERT INTO
    attendance(
        employee_id,
        login_time,
        logout_time,
        date
    )
VALUES (1, '9:00', '6:00', '2023-08-01'), (2, '9:00', '6:00', '2023-08-01'), (3, '9:00', '6:00', '2023-08-01'), (4, '9:00', '6:00', '2023-08-01'), (5, '', '', '2023-08-01'), (6, '9:00', '6:00', '2023-08-01'), (7, '', '', '2023-08-01'), (8, '9:00', '6:00', '2023-08-01'), (9, '9:00', '6:00', '2023-08-01'), (
        10,
        '9:00',
        '6:00',
        '2023-08-01'
    ), (1, '9:00', '6:00', '2023-08-02'), (2, '9:00', '6:00', '2023-08-02'), (3, '9:00', '6:00', '2023-08-02'), (4, '9:00', '6:00', '2023-08-02'), (5, '9:00', '6:00', '2023-08-02'), (6, '9:00', '6:00', '2023-08-02'), (7, '9:00', '6:00', '2023-08-02'), (8, '9:00', '6:00', '2023-08-02'), (9, '9:00', '6:00', '2023-08-02'), (
        10,
        '9:00',
        '6:00',
        '2023-08-02'
    ), (1, '9:00', '6:00', '2023-08-03'), (2, '9:00', '6:00', '2023-08-03'), (3, '9:00', '6:00', '2023-08-03'), (4, '9:00', '6:00', '2023-08-03'), (5, '9:00', '6:00', '2023-08-03'), (6, '9:00', '6:00', '2023-08-03'), (7, '9:00', '6:00', '2023-08-03'), (8, '9:00', '6:00', '2023-08-03'), (9, '9:00', '6:00', '2023-08-03'), (
        10,
        '9:00',
        '6:00',
        '2023-08-03'
    ), (1, '9:00', '6:00', '2023-08-04'), (2, '9:00', '6:00', '2023-08-04'), (3, '9:00', '6:00', '2023-08-04'), (4, '9:00', '6:00', '2023-08-04'), (5, '9:00', '6:00', '2023-08-04'), (6, '9:00', '6:00', '2023-08-04'), (7, '', '', '2023-08-04'), (8, '9:00', '6:00', '2023-08-04'), (9, '9:00', '6:00', '2023-08-04'), (
        10,
        '9:00',
        '6:00',
        '2023-08-04'
    ), (1, '9:00', '6:00', '2023-08-05'), (2, '9:00', '6:00', '2023-08-05'), (3, '9:00', '6:00', '2023-08-05'), (4, '9:00', '6:00', '2023-08-05'), (5, '9:00', '6:00', '2023-08-05'), (6, '9:00', '6:00', '2023-08-05'), (7, '9:00', '6:00', '2023-08-05'), (8, '', '', '2023-08-05'), (9, '9:00', '6:00', '2023-08-05'), (
        10,
        '9:00',
        '6:00',
        '2023-08-05'
    ), (1, '9:00', '6:00', '2023-08-06'), (2, '9:00', '6:00', '2023-08-06'), (3, '9:00', '6:00', '2023-08-06'), (4, '9:00', '6:00', '2023-08-06'), (5, '9:00', '6:00', '2023-08-06'), (6, '9:00', '6:00', '2023-08-06'), (7, '9:00', '6:00', '2023-08-06'), (8, '9:00', '6:00', '2023-08-06'), (9, '9:00', '6:00', '2023-08-06'), (
        10,
        '9:00',
        '6:00',
        '2023-08-06'
    ), (1, '9:00', '6:00', '2023-08-07'), (2, '9:00', '6:00', '2023-08-07'), (3, '9:00', '6:00', '2023-08-07'), (4, '', '', '2023-08-07'), (5, '', '', '2023-08-07'), (6, '9:00', '6:00', '2023-08-07'), (7, '9:00', '6:00', '2023-08-07'), (8, '9:00', '6:00', '2023-08-07'), (9, '', '', '2023-08-07'), (
        10,
        '9:00',
        '6:00',
        '2023-08-07'
    ), (1, '', '', '2023-08-08'), (2, '9:00', '6:00', '2023-08-08'), (3, '9:00', '6:00', '2023-08-08'), (4, '', '', '2023-08-08'), (5, '9:00', '6:00', '2023-08-08'), (6, '9:00', '6:00', '2023-08-08'), (7, '9:00', '6:00', '2023-08-08'), (8, '9:00', '6:00', '2023-08-08'), (9, '9:00', '6:00', '2023-08-08'), (
        10,
        '9:00',
        '6:00',
        '2023-08-08'
    ), (1, '', '', '2023-08-09'), (2, '9:00', '6:00', '2023-08-09'), (3, '9:00', '6:00', '2023-08-09'), (4, '9:00', '6:00', '2023-08-09'), (5, '9:00', '6:00', '2023-08-09'), (6, '9:00', '6:00', '2023-08-09'), (7, '9:00', '6:00', '2023-08-09'), (8, '9:00', '6:00', '2023-08-09'), (9, '9:00', '6:00', '2023-08-09'), (
        10,
        '9:00',
        '6:00',
        '2023-08-09'
    ), (1, '9:00', '6:00', '2023-08-10'), (2, '9:00', '6:00', '2023-08-10'), (3, '9:00', '6:00', '2023-08-10'), (4, '9:00', '6:00', '2023-08-10'), (5, '9:00', '6:00', '2023-08-10'), (6, '9:00', '6:00', '2023-08-10'), (7, '9:00', '6:00', '2023-08-10'), (8, '9:00', '6:00', '2023-08-10'), (9, '9:00', '6:00', '2023-08-10'), (
        10,
        '9:00',
        '6:00',
        '2023-08-10'
    ), (1, '9:00', '6:00', '2023-08-11'), (2, '9:00', '6:00', '2023-08-11'), (3, '9:00', '6:00', '2023-08-11'), (4, '9:00', '6:00', '2023-08-11'), (5, '9:00', '6:00', '2023-08-11'), (6, '9:00', '6:00', '2023-08-11'), (7, '9:00', '6:00', '2023-08-11'), (8, '', '', '2023-08-11'), (9, '9:00', '6:00', '2023-08-11'), (
        10,
        '9:00',
        '6:00',
        '2023-08-11'
    ), (1, '9:00', '6:00', '2023-08-12'), (2, '9:00', '6:00', '2023-08-12'), (3, '9:00', '6:00', '2023-08-12'), (4, '9:00', '6:00', '2023-08-12'), (5, '9:00', '6:00', '2023-08-12'), (6, '9:00', '6:00', '2023-08-12'), (7, '9:00', '6:00', '2023-08-12'), (8, '9:00', '6:00', '2023-08-12'), (9, '9:00', '6:00', '2023-08-12'), (
        10,
        '9:00',
        '6:00',
        '2023-08-12'
    ), (1, '9:00', '6:00', '2023-08-13'), (2, '9:00', '6:00', '2023-08-13'), (3, '9:00', '6:00', '2023-08-13'), (4, '9:00', '6:00', '2023-08-13'), (5, '9:00', '6:00', '2023-08-13'), (6, '9:00', '6:00', '2023-08-13'), (7, '', '', '2023-08-13'), (8, '9:00', '6:00', '2023-08-13'), (9, '9:00', '6:00', '2023-08-13'), (
        10,
        '9:00',
        '6:00',
        '2023-08-13'
    ), (1, '9:00', '6:00', '2023-08-14'), (2, '9:00', '6:00', '2023-08-14'), (3, '', '', '2023-08-14'), (4, '9:00', '6:00', '2023-08-14'), (5, '9:00', '6:00', '2023-08-14'), (6, '9:00', '6:00', '2023-08-14'), (7, '9:00', '6:00', '2023-08-14'), (8, '9:00', '6:00', '2023-08-14'), (9, '9:00', '6:00', '2023-08-14'), (
        10,
        '9:00',
        '6:00',
        '2023-08-14'
    ), (1, '9:00', '6:00', '2023-08-15'), (2, '9:00', '6:00', '2023-08-15'), (3, '9:00', '6:00', '2023-08-15'), (4, '9:00', '6:00', '2023-08-15'), (5, '9:00', '6:00', '2023-08-15'), (6, '9:00', '6:00', '2023-08-15'), (7, '9:00', '6:00', '2023-08-15'), (8, '9:00', '6:00', '2023-08-15'), (9, '9:00', '6:00', '2023-08-15'), (
        10,
        '9:00',
        '6:00',
        '2023-08-15'
    ), (1, '9:00', '6:00', '2023-08-16'), (2, '9:00', '6:00', '2023-08-16'), (3, '9:00', '6:00', '2023-08-16'), (4, '9:00', '6:00', '2023-08-16'), (5, '9:00', '6:00', '2023-08-16'), (6, '9:00', '6:00', '2023-08-16'), (7, '9:00', '6:00', '2023-08-16'), (8, '9:00', '6:00', '2023-08-16'), (9, '9:00', '6:00', '2023-08-16'), (
        10,
        '9:00',
        '6:00',
        '2023-08-16'
    ), (1, '9:00', '6:00', '2023-08-17'), (2, '9:00', '6:00', '2023-08-17'), (3, '9:00', '6:00', '2023-08-17'), (4, '9:00', '6:00', '2023-08-17'), (5, '9:00', '6:00', '2023-08-17'), (6, '9:00', '6:00', '2023-08-17'), (7, '9:00', '6:00', '2023-08-17'), (8, '9:00', '6:00', '2023-08-17'), (9, '9:00', '6:00', '2023-08-17'), (
        10,
        '9:00',
        '6:00',
        '2023-08-17'
    ), (1, '9:00', '6:00', '2023-08-18'), (2, '9:00', '6:00', '2023-08-18'), (3, '9:00', '6:00', '2023-08-18'), (4, '', '', '2023-08-18'), (5, '9:00', '6:00', '2023-08-18'), (6, '9:00', '6:00', '2023-08-18'), (7, '9:00', '6:00', '2023-08-18'), (8, '9:00', '6:00', '2023-08-18'), (9, '9:00', '6:00', '2023-08-18'), (
        10,
        '9:00',
        '6:00',
        '2023-08-18'
    ), (1, '', '', '2023-08-19'), (2, '9:00', '6:00', '2023-08-19'), (3, '9:00', '6:00', '2023-08-19'), (4, '9:00', '6:00', '2023-08-19'), (5, '9:00', '6:00', '2023-08-19'), (6, '9:00', '6:00', '2023-08-19'), (7, '9:00', '6:00', '2023-08-19'), (8, '9:00', '6:00', '2023-08-19'), (9, '9:00', '6:00', '2023-08-19'), (
        10,
        '9:00',
        '6:00',
        '2023-08-19'
    ), (1, '9:00', '6:00', '2023-08-20'), (2, '', '', '2023-08-20'), (3, '9:00', '6:00', '2023-08-20'), (4, '9:00', '6:00', '2023-08-20'), (5, '9:00', '6:00', '2023-08-20'), (6, '9:00', '6:00', '2023-08-20'), (7, '9:00', '6:00', '2023-08-20'), (8, '9:00', '6:00', '2023-08-20'), (9, '9:00', '6:00', '2023-08-20'), (
        10,
        '9:00',
        '6:00',
        '2023-08-20'
    ), (1, '9:00', '6:00', '2023-08-21'), (2, '9:00', '6:00', '2023-08-21'), (3, '9:00', '6:00', '2023-08-21'), (4, '9:00', '6:00', '2023-08-21'), (5, '9:00', '6:00', '2023-08-21'), (6, '9:00', '6:00', '2023-08-21'), (7, '9:00', '6:00', '2023-08-21'), (8, '9:00', '6:00', '2023-08-21'), (9, '9:00', '6:00', '2023-08-21'), (
        10,
        '9:00',
        '6:00',
        '2023-08-21'
    );

SELECT * from attendance;

DROP Table attendance;

CREATE TABLE
    Payroll(
        payroll_id SERIAL PRIMARY KEY,
        employee_id INT REFERENCES Employees(employee_id) NOT NULL,
        salary INT NOT NULL,
        daily_payOut DECIMAL(10, 2)
    );

INSERT INTO
    Payroll(
        employee_id,
        salary,
        daily_payOut
    )
VALUES (1, 80000, 3636.36), (5, 60000, 2727.27);

INSERT INTO
    Payroll(
        employee_id,
        salary,
        daily_payOut
    )
VALUES (1, 80000, 3636.36), (2, 60000, 2727.27), (3, 70000, 3181.81), (4, 40000, 1818.18), (5, 40000, 1818.18), (6, 40000, 1818.18), (7, 25000, 1136.36), (8, 25000, 1136.36), (9, 25000, 1136.36), (10, 20000, 909.09);

DROP Table payroll;

CREATE TABLE
    Projects(
        id SERIAL NOT NULL PRIMARY KEY,
        project_name VARCHAR(250) NOT NULL UNIQUE,
        project_deadline DATE NOT NULL
    );

SELECT * FROM projects;

DROP TABLE projects;

CREATE TABLE
    assignProject(
        project_id SERIAL NOT NULL PRIMARY KEY,
        project_name VARCHAR(250) NOT NULL,
        employee_id INT REFERENCES Employees(employee_id) NOT NULL
    );

DROP Table assignProject;

SELECT * FROM assignproject;

SELECT *
from employees
    left JOIN payroll on employees.employee_id = payroll.employee_id;

CREATE TABLE
    Loans(
        loan_id SERIAL PRIMARY KEY,
        employee_id INT REFERENCES Employees(employee_id),
        loan_amount DECIMAL(10, 2) NOT NULL,
        remaining_amount DECIMAL(10, 2) NOT NULL,
        deduction_amount DECIMAL(10, 2),
        start_date DATE,
        end_date DATE
    );

INSERT INTO
    loans(
        employee_id,
        loan_amount,
        remaining_amount,
        deduction_amount,
        start_date,
        end_date
    )
VALUES (
        1,
        1000000,
        300000,
        10000,
        '21-10-2017',
        '12-6-2025'
    ), (
        5,
        500000,
        100000,
        5000,
        '21-10-2017',
        '12-6-2026'
    );

INSERT INTO
    loans(
        employee_id,
        loan_amount,
        remaining_amount,
        deduction_amount,
        start_date,
        end_date
    )
VALUES (
        1,
        1000000,
        300000,
        10000,
        '21-10-2017',
        '12-6-2025'
    ), (
        2,
        500000,
        100000,
        5000,
        '21-10-2017',
        '12-6-2026'
    ), (
        3,
        500000,
        100000,
        10000,
        '21-10-2018',
        '12-6-2024'
    ), (
        4,
        500000,
        100000,
        5000,
        '21-8-2018',
        '12-6-2025'
    ), (
        5,
        500000,
        100000,
        5000,
        '21-10-2016',
        '12-6-2024'
    ), (
        6,
        500000,
        100000,
        5000,
        '21-10-2019',
        '12-6-2027'
    ), (
        7,
        500000,
        100000,
        5000,
        '21-10-2017',
        '12-6-2026'
    ), (
        8,
        500000,
        100000,
        5000,
        '21-10-2017',
        '12-6-2026'
    ), (
        9,
        700000,
        100000,
        7000,
        '21-10-2017',
        '12-6-2026'
    ), (
        10,
        400000,
        100000,
        4000,
        '21-10-2017',
        '12-6-2026'
    );

DROP TABLE loans;

SELECT * FROM loans;

SELECT
    employees.employee_id,
    emp_name,
    employees.emp_email,
    salary,
    loan_amount,
    deduction_amount,
    daily_payout - (
        SELECT
            L.deduction_amount
        from loans L
        WHERE
            employees.employee_id = L.employee_id
    ) / 22 daily_payout,
    salary - (
        SELECT
            deduction_amount
        from loans
        WHERE
            employees.employee_id = loans.employee_id
    ) take_home_salary
FROM employees
    INNER JOIN payroll ON payroll.employee_id = employees.employee_id
    INNER JOIN loans ON loans.employee_id = employees.employee_id
WHERE employees.employee_id = 1;